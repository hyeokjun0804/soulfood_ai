<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>{{ restaurant.restaurant_name }} - 식당 정보</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'restaurant/css/restaurant_detail.css' %}">

        <!-- 네이버 지도 API 스크립트 추가 (YOUR_CLIENT_ID에 발급받은 클라이언트 ID 입력) -->
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=u4fx9tpgpd"></script>
</head>
<body>
    <!-- Navbar Inclusion -->
    {% include 'navbar.html' %}

    <div class="restaurant-detail">
        <h1>{{ restaurant.restaurant_name }}</h1>
        <p><strong>카테고리:</strong> {{ restaurant.category.name }}</p>
        <p><strong>도로명 주소:</strong> {{ restaurant.road_address }}</p>
        <p><strong>지번 주소:</strong> {{ restaurant.jibun_address }}</p>
        <p><strong>전화번호:</strong> {{ restaurant.phone_number|default:"없음" }}</p>
        <p><strong>평일 영업시간:</strong> {{ restaurant.weekday_hours }}</p>
        <p><strong>주말 영업시간:</strong> {{ restaurant.weekend_hours }}</p>

        <p><strong>무료 주차:</strong> {% if restaurant.free_parking %} 가능 {% else %} 불가능 {% endif %}</p>
        <p><strong>유아용 의자:</strong> {% if restaurant.baby_chair %} 있음 {% else %} 없음 {% endif %}</p>
        <p><strong>애견 동반:</strong> {% if restaurant.pet_friendly %} 가능 {% else %} 불가능 {% endif %}</p>

                <!-- Naver Map -->
        <div id="map" class="map"></div>

        <!-- Reviews -->
        <div class="reviews">
            <h3>리뷰</h3>
            {% for review in reviews %}
                <div class="review">
                    {% if review.user.profile_image %}
                        <img src="{{ review.user.profile_image.url }}" alt="{{ review.user.username }}'s profile image">
                    {% else %}
                        <img src="{% static 'account/img/default_profile.png' %}" alt="Default profile image">
                    {% endif %}
                    <strong>{{ review.user.username }}</strong> : {{ review.rating }}점
                    <p>{{ review.comment }}</p>
                    <p>작성일: {{ review.created_at }}</p>

                    {% if review.user == request.user %}
                        <a href="{% url 'restaurant:edit_review' review.id %}" class="btn btn-primary">수정</a>
                        <form action="{% url 'restaurant:delete_review' review.id %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger">삭제</button>
                        </form>
                    {% endif %}
                </div>
            {% empty %}
                <p>등록된 리뷰가 없습니다.</p>
            {% endfor %}
        </div>

        <!-- Review Form -->
        <div class="review-form">
            <h3>리뷰 작성하기</h3>
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn">리뷰 작성</button>
            </form>
        </div>
    </div>


    <a href="#" class="back-button" onclick="history.back(); return false;">뒤로 가기</a>
    <script type="text/javascript">
        // 식당 위치 정보를 JavaScript 변수로 설정
        var latitude = {{ restaurant.latitude }};
        var longitude = {{ restaurant.longitude }};
        var restaurantName = "{{ restaurant.restaurant_name }}";
        var category = "{{ restaurant.category.name }}";

        // 지도 초기화
        var mapOptions = {
            center: new naver.maps.LatLng(latitude, longitude),
            zoom: 15
        };
        var map = new naver.maps.Map('map', mapOptions);

        // 마커 생성
        var marker = new naver.maps.Marker({
            position: new naver.maps.LatLng(latitude, longitude),
            map: map,
            title: restaurantName
        });

        // 정보창 생성
        var infoWindow = new naver.maps.InfoWindow({
            content: `
                <div style="width:150px;text-align:center;padding:10px;">
                    <strong>${restaurantName}</strong><br>
                    <span>종류: ${category}</span>
                </div>
            `,
            borderWidth: 1,
            borderColor: "#666",
            backgroundColor: "white"
        });

        // 마커 클릭 시 정보창 열기
        naver.maps.Event.addListener(marker, "click", function() {
            infoWindow.open(map, marker);
        });
    </script>
</body>
</html>
